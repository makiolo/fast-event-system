language: c
services: docker
# https://docs.travis-ci.com/user/languages/cpp/
os: linux
compiler: clang
addons:
  apt:
    sources:
      - llvm-toolchain-trusty-5.0
    packages:
      - clang-5.0
install:
  - pip install --user conan==1.9.1
  - conan remote add bincrafters "https://api.bintray.com/conan/bincrafters/public-conan"
  - conan remote add npm-mas-mas "https://api.bintray.com/conan/npm-mas-mas/testing"
  - conan user -p $CONAN_TOKEN -r npm-mas-mas makiolo
env:
  - MODE=Debug COMPILER=clang COMPILER_VERSION=5.0 COMPILER_LIBCXX=libstdc++ CC=clang-5.0 CXX=clang++-5.0
  - MODE=Release COMPILER=clang COMPILER_VERSION=5.0 COMPILER_LIBCXX=libstdc++ CC=clang-5.0 CXX=clang++-5.0
script:

  # Deserialize compilation
  - conan install . -r npm-mas-mas -s compiler=$COMPILER -s build_type=$MODE -s compiler.libcxx=$COMPILER_LIBCXX -s compiler.version=$COMPILER_VERSION

  # Comopile gtest if is missing
  - conan install gtest/1.8.1@bincrafters/stable --build missing -s compiler=$COMPILER -s build_type=$MODE -s compiler.libcxx=$COMPILER_LIBCXX -s compiler.version=$COMPILER_VERSION
  # Compile boost if is missing
  - conan install boost/1.70.0@conan/stable --build mssing -s compiler=$COMPILER -s build_type=$MODE -s compiler.libcxx=$COMPILER_LIBCXX -s compiler.version=$COMPILER_VERSION

  # Crear package
  - conan create . npm-mas-mas/testing -s compiler=$COMPILER -s build_type=$MODE -s compiler.libcxx=$COMPILER_LIBCXX -s compiler.version=$COMPILER_VERSION -tf None

  # Serialize compilation
  - conan upload "*" -r npm-mas-mas --all -c

